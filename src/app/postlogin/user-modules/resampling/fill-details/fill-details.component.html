<div align="right">
  <button class="close-btn" style="border-radius: 5em; color: black;" (click)="onClose()" tabIndex="-2">
    <mat-icon>clear</mat-icon>
  </button>
</div>

<div class="vendor-form-wrapper">
  <mat-card class="vendor-form-card">
    <div class="vendor-toolbar">
      <mat-icon>description</mat-icon>
      <span>Installed Material Details</span>
    </div>

    <form [formGroup]="vendorForm" (ngSubmit)="onSubmit()" class="vendor-form-outer">
      <div formArrayName="vendors" class="vendor-array-wrapper pd-5">
        <ng-container *ngFor="let group of vendorRows.controls; let i = index; trackBy: trackByIndex">
          <div [formGroupName]="i" class="vendor-form-grid vendor-row">

            <!-- Row heading + remove btn -->
            <div class="vendor-row-header" *ngIf="vendorRows.length > 1">
              <div class="vendor-row-title">Item Details #{{ i + 1 }}</div>
              <button mat-icon-button color="warn" type="button" (click)="removeVendor(i)" aria-label="Remove row">
                <mat-icon>delete</mat-icon>
              </button>
            </div>

            <!-- Vendor Name -->
            <div class="row">
              <div class="col-sm-6">
                <mat-form-field appearance="outline">
                  <mat-label>Vendor Name</mat-label>
                  <mat-select formControlName="vendorName"
                    (selectionChange)="onSelectVender($event?.value?.Material_details, i)"
                    [disableOptionCentering]="true" panelClass="vendor-select-panel" #vendorSelect>

                    <!-- Search bar (disabled option so select won't close) -->
                    <mat-option [disabled]="true" class="vendor-search-option">
                      <input matInput type="text" placeholder="Search vendor..." (click)="$event.stopPropagation()"
                        (keydown)="$event.stopPropagation()"
                        (keyup)="filterVendorOptions($any($event.target).value, vendorSelect)" class="vendor-search" />
                    </mat-option>

                    <!-- Vendor List -->
                    <mat-option *ngFor="let vendor of vendors" [value]="vendor">
                      {{ vendor?.Company_ame }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <!-- Materials Specification -->
              <div class="col-sm-6">
                <mat-form-field appearance="outline">
                  <mat-label>Materials Specification</mat-label>
                  <mat-select formControlName="meterialSpecification"
                    (selectionChange)="onSelectMaterial($event?.value, i)" [disableOptionCentering]="true"
                    panelClass="material-select-panel" #materialSelect>

                    <!-- Search bar -->
                    <mat-option [disabled]="true" class="vendor-search-option">
                      <input matInput type="text" placeholder="Search material..." (click)="$event.stopPropagation()"
                        (keydown)="$event.stopPropagation()"
                        (keyup)="filterMaterialOptions($any($event.target).value, materialSelect)"
                        class="vendor-search" />
                    </mat-option>

                    <!-- Material Options -->
                    <mat-option *ngFor="let obj of vendorRows.at(i).get('vendorName')?.value?.Material_details"
                      [value]="obj">
                      {{ obj?.Material_Specification }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <!-- Serial No -->
              <div class="col-sm-4">
                <mat-form-field appearance="outline">
                  <mat-label>Item No.</mat-label>
                  <input matInput type="text" formControlName="itemNo" />
                </mat-form-field>
              </div>

              <!-- Item No -->
              <div class="col-sm-4">
                <mat-form-field appearance="outline">
                  <mat-label>Material Name</mat-label>
                  <input matInput formControlName="materialName" />
                </mat-form-field>
              </div>

              <!-- Serial No -->
              <div class="col-sm-4">
                <mat-form-field appearance="outline">
                  <mat-label>Serial No</mat-label>
                  <input matInput formControlName="serialNo" />
                </mat-form-field>
              </div>


              <!-- Capacity -->
              <!-- <div class="col-sm-4">
                <mat-form-field appearance="outline">
                  <mat-label>Capacity</mat-label>
                  <input matInput type="number" formControlName="capacityOfDtr" />
                </mat-form-field>
              </div> -->
              <!-- Capacity -->
              <div class="col-sm-4" [hidden]="true">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Capacity</mat-label>
                  <mat-select formControlName="capacityOfDtr">
                    <mat-option *ngFor="let cap of capacities" [value]="cap">{{ cap }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>


              <!-- Invoice No -->
              <div class="col-sm-4">
                <mat-form-field appearance="outline">
                  <mat-label>Invoice No</mat-label>
                  <input matInput formControlName="invoiceNO" />
                </mat-form-field>
              </div>

              <!-- Year of Manufacture (Year Only) -->
              <!-- <div class="col-sm-4">
                <mat-form-field appearance="outline">
                  <mat-label>Year of Manufacture</mat-label>
                  <input matInput [matDatepicker]="picker" formControlName="yearOfManufacture" readonly />
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker startView="multi-year" (yearSelected)="onYearSelected($event, picker, i)"
                    panelClass="year-only-picker"></mat-datepicker>
                </mat-form-field>
              </div> -->




              <!-- Year of Manufacture (MM-YYYY) -->
              <div class="col-sm-4">
                <mat-form-field appearance="outline">
                  <mat-label>Year of Manufacture</mat-label>
                  <input matInput [matDatepicker]="picker" formControlName="yearOfManufacture" [max]="today" readonly />
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker startView="multi-year" (monthSelected)="onMonthSelected($event, picker, i)"
                    panelClass="month-year-picker">
                  </mat-datepicker>
                </mat-form-field>
                <div class="col-sm-12" *ngIf="vendorRows.at(i).errors?.dateOrderInvalid">
                  <mat-error>
                    Installation Date must be after Year of Manufacture
                  </mat-error>
                </div>

              </div>


              <!-- Year of Installation (MM-YYYY) -->
              <div class="col-sm-4">
                <mat-form-field appearance="outline">
                  <mat-label>Year of Installation</mat-label>
                  <input matInput [matDatepicker]="pickerNew" formControlName="instalationDate" [max]="today"
                    readonly />
                  <mat-datepicker-toggle matSuffix [for]="pickerNew"></mat-datepicker-toggle>
                  <mat-datepicker #pickerNew startView="multi-year"
                    (monthSelected)="onMonthSelectedInstallation($event, picker, i)" panelClass="month-year-picker">
                  </mat-datepicker>
                </mat-form-field>
                <div class="col-sm-12" *ngIf="vendorRows.at(i).errors?.dateOrderInvalid">
                  <mat-error>
                    Installation Date must be after Year of Manufacture
                  </mat-error>
                </div>

              </div>



            </div>
          </div>

          <mat-divider *ngIf="i < vendorRows.length - 1"></mat-divider>
        </ng-container>
      </div>

      <!-- Add another row -->
      <div class="add-row-btn-container">
        <button mat-stroked-button color="primary" type="button" (click)="addVendor()">
          <mat-icon>add</mat-icon>
          Add Another Material
        </button>
      </div>

      <!-- Submit -->
      <div class="submit-btn-container">
        <button mat-raised-button color="primary" type="submit" class="submit-btn">
          Submit
        </button>
      </div>
    </form>


  </mat-card>
</div>